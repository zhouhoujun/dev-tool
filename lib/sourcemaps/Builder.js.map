{"version":3,"sources":["Builder.ts"],"names":[],"mappings":"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","file":"../Builder.js","sourcesContent":["import {\r\n    ITaskContext, IMap, IAsserts, TaskContext, ITaskConfig, Src, ITask, IDynamicTaskOption, Operation, RunWay, Builder, Order, IOrder\r\n} from 'development-core';\r\nimport * as _ from 'lodash';\r\nimport { TaskCallback } from 'gulp';\r\nimport * as path from 'path';\r\nimport { IContext } from './IContext';\r\nimport { ITaskOption } from './TaskOption';\r\nimport { ILoaderFactory, LoaderFactory } from './loaderFactory';\r\nimport { Context } from './Context';\r\nimport { TaskOption } from './types';\r\n\r\nexport class ContextBuilder implements Builder {\r\n\r\n    /**\r\n     * build context component.\r\n     *\r\n     * @protected\r\n     * @memberof Development\r\n     */\r\n    build<T extends IAsserts>(node: ITaskContext, option?: T): ITaskContext | Promise<ITaskContext> {\r\n        let ctx = node as IContext;\r\n        return option ? this.buildContexts(ctx, option) : this.buildContext(ctx);\r\n    }\r\n\r\n\r\n    /**\r\n     * is built or not.\r\n     *\r\n     * @param {ITaskContext} node\r\n     * @returns {boolean}\r\n     * @memberof ContextBuilder\r\n     */\r\n    isBuilt(node: ITaskContext): boolean {\r\n        return node && node['__built'];\r\n    }\r\n\r\n    clean(node: ITaskContext) {\r\n        if (node) {\r\n            node['__built'] = undefined;\r\n        }\r\n    }\r\n\r\n    setBuilt(node: ITaskContext) {\r\n        if (node) {\r\n            node['__built'] = true;\r\n        }\r\n    }\r\n\r\n    protected buildContext(node: IContext): Promise<ITaskContext> {\r\n        return node.getLoader()\r\n            .load()\r\n            .then((tasks) => {\r\n                // this.setBuilt(node);\r\n                let component = [];\r\n                let optask = node.option as ITaskOption;\r\n                let env = node.env;\r\n                if (optask.refs && optask.refs.length > 0) {\r\n\r\n                    let refsctx = node.add(<ITaskOption>{\r\n                        name: 'refs',\r\n                        loader: [],\r\n                        order: optask.refsOrder,\r\n                        runWay: optask.refsRunWay\r\n                    }) as IContext;\r\n\r\n                    optask.refs.forEach(rf => {\r\n                        let name: string, pjpath: string, cmd, args: string[], extraArgs: string[], excludeArgs: string[];\r\n                        if (_.isString(rf)) {\r\n                            name = path.basename(rf);\r\n                            pjpath = refsctx.toRootPath(rf);\r\n                        } else if (_.isFunction(rf)) {\r\n                            pjpath = refsctx.toRootPath(refsctx.toStr(rf));\r\n                            name = path.basename(pjpath);\r\n                        } else if (rf) {\r\n                            pjpath = refsctx.toRootPath(refsctx.toStr(rf.path));\r\n                            name = rf.name ? refsctx.toStr(rf.name) : path.basename(pjpath);\r\n                            cmd = refsctx.toStr(rf.cmd);\r\n                            let srcArgs = refsctx.toSrc(rf.args);\r\n                            if (srcArgs) {\r\n                                if (_.isArray(srcArgs) && srcArgs.length > 0) {\r\n                                    args = srcArgs;\r\n                                } else if (srcArgs && _.isString(srcArgs)) {\r\n                                    args = [srcArgs];\r\n                                }\r\n                            }\r\n                            if (rf.extraArgs) {\r\n                                extraArgs = _.isArray(rf.extraArgs) ? rf.extraArgs : [rf.extraArgs];\r\n                            }\r\n                            if (rf.excludeArgs) {\r\n                                excludeArgs = _.isArray(rf.excludeArgs) ? rf.excludeArgs : [rf.excludeArgs];\r\n                            }\r\n                        }\r\n                        if (!pjpath) {\r\n                            return null;\r\n                        }\r\n\r\n                        let task = _.extend(rf || {}, {\r\n                            name: name,\r\n                            loader: [\r\n                                {\r\n                                    shell: (ctx) => {\r\n                                        if (!args) {\r\n                                            args = [];\r\n                                            _.keys(env).map(k => {\r\n                                                if (k === 'root' || !/^[a-zA-Z]/.test(k)) {\r\n                                                    return;\r\n                                                }\r\n                                                let val = env[k];\r\n                                                if (_.isBoolean(val)) {\r\n                                                    if (val) {\r\n                                                        args.push(`--${k}`);\r\n                                                    }\r\n                                                } else if (val) {\r\n                                                    args.push(`--${k} ${val}`);\r\n                                                }\r\n\r\n                                            });\r\n                                        }\r\n\r\n                                        if (excludeArgs && excludeArgs.length > 0) {\r\n                                            args = args.filter(it => excludeArgs.lastIndexOf(it) < 0);\r\n                                        }\r\n                                        cmd = cmd || 'gulp start';\r\n                                        let cmds = '';\r\n\r\n                                        if (/^[C-Z]:/.test(pjpath)) {\r\n                                            cmds = _.first(pjpath.split(':')) + ': && ';\r\n                                        }\r\n                                        cmds += `cd ${pjpath} && ${cmd}`;\r\n                                        if (extraArgs) {\r\n                                            args = args.concat(extraArgs);\r\n                                        }\r\n                                        cmds += ` ${args.join(' ')}`;\r\n                                        return cmds;\r\n                                    }\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        refsctx.add(task);\r\n\r\n                    });\r\n                }\r\n\r\n                if (optask.asserts) {\r\n                    let assertctx = node.add(<ITaskOption>{ name: 'asserts', loader: [], order: optask.assertsOrder }) as IContext;\r\n                    let asserts = optask.asserts;\r\n                    optask.asserts = null;\r\n                    component.push(this.buildAssertContext(assertctx, asserts, optask.assertsRunWay));\r\n                }\r\n                if (optask.tasks) {\r\n                    component.push(this.buildSubContext(node));\r\n                }\r\n\r\n                return Promise.all(component);\r\n\r\n            })\r\n            .then(() => {\r\n                this.setBuilt(node);\r\n                return node;\r\n            });\r\n\r\n    }\r\n\r\n    protected buildContexts(parent: IContext, taskOptions: TaskOption): Promise<ITaskContext> {\r\n        return parent.getLoader()\r\n            .load()\r\n            .then(() => {\r\n                return this.createContexts(parent, taskOptions);\r\n            })\r\n            .then(() => {\r\n                this.setBuilt(parent);\r\n                return parent;\r\n\r\n            })\r\n    }\r\n\r\n    protected createContexts(node: IContext, taskOptions: TaskOption): Promise<ITaskContext[]> {\r\n        let tasks: ITaskOption[] = _.isArray(taskOptions) ? taskOptions : [taskOptions];\r\n        if (node.env['exclude']) {\r\n            let excludes = _.filter(node.env['exclude'].split(','), it => !!it);\r\n            if (excludes.length > 0) {\r\n                tasks = tasks.filter(t => {\r\n                    if (t.name) {\r\n                        return excludes.indexOf(t.name) < 0;\r\n                    }\r\n                    return true;\r\n                });\r\n            }\r\n\r\n        }\r\n        return Promise.all(tasks.map(optask => {\r\n            if (optask.oper && node.oper && (node.oper & node.to(optask.oper)) <= 0) {\r\n                return null;\r\n            }\r\n            let ctx: IContext = node.add(optask) as IContext;\r\n            return this.buildContext(ctx);\r\n        }));\r\n    }\r\n\r\n    /**\r\n    * build asserts tasks.\r\n    *\r\n    * @protected\r\n    * @param {ITaskContext} ctx\r\n    *\r\n    * @memberOf Builder\r\n    */\r\n    protected buildAssertContext(ctx: IContext, asserts: IMap<Operation | Src | IAsserts | IDynamicTaskOption[]>, runWay?: RunWay) {\r\n        let tasks: ITaskOption[] = [];\r\n        runWay = runWay || RunWay.parallel;\r\n        _.each(_.keys(asserts), name => {\r\n            let op: ITaskOption;\r\n            let sr = asserts[name];\r\n            if (_.isString(sr)) {\r\n                op = <ITaskOption>{ src: sr };\r\n            } else if (_.isNumber(sr)) {\r\n                // watch with Operation.autoWatch.\r\n                op = <ITaskOption>{ loader: [{ oper: sr, name: name, pipes: [] }] };\r\n            } else if (_.isFunction(sr)) {\r\n                op = <ITaskOption>{ loader: sr };\r\n            } else if (_.isArray(sr)) {\r\n                if (sr.length > 0) {\r\n                    if (!_.some(<string[]>sr, it => !_.isString(it))) {\r\n                        op = <ITaskOption>{ src: <string[]>sr };\r\n                    } else {\r\n                        op = <ITaskOption>{ loader: <IDynamicTaskOption[]>sr, watch: true };\r\n                    }\r\n                }\r\n            } else {\r\n                op = sr;\r\n            }\r\n\r\n            if (_.isNull(op) || _.isUndefined(op)) {\r\n                return;\r\n            }\r\n            if (!op.loader) {\r\n                op.loader = [{ name: name, pipes: [], watch: true }]\r\n            }\r\n            op.defaultTaskName = name;\r\n            op.src = op.src || (ctx.getSrc() + '/**/*.' + name);\r\n            // op.dist = op.dist || ctx.getDist();\r\n\r\n            if (_.isUndefined(op.order) || _.isNull(op.order)) {\r\n                op.order = { runWay: runWay }\r\n            } else {\r\n                op.order = ctx.to<Order>(op.order);\r\n                if (_.isNumber(op.order)) {\r\n                    op.order = { value: op.order, runWay: runWay };\r\n                }\r\n            }\r\n            tasks.push(op);\r\n        });\r\n\r\n        return this.createContexts(ctx, tasks);\r\n    }\r\n    /**\r\n     * build sub context.\r\n     *\r\n     * @protected\r\n     * @param {IContext} ctx\r\n     *\r\n     * @memberOf Builder\r\n     */\r\n    protected buildSubContext(ctx: IContext) {\r\n\r\n        let optask = <ITaskOption>ctx.option;\r\n        if (!optask.tasks) {\r\n            return null;\r\n        }\r\n        let tasks = _.isArray(optask.tasks) ? optask.tasks : [optask.tasks];\r\n        // let idex = 0;\r\n        let subtasks = tasks.map(opt => {\r\n            let subopt = opt as ITaskOption;\r\n            if (!subopt.order) {\r\n                let subOrder = ctx.to<Order>(optask.subTaskOrder);\r\n                if (!_.isNumber(subOrder) && subOrder) {\r\n                    optask.order = optask.order || (<IOrder>subOrder).runWay;\r\n                } else if (optask.subTaskRunWay) {\r\n                    subopt.order = { runWay: optask.subTaskRunWay };\r\n                }\r\n            }\r\n            if (!subopt.loader && subopt.src && subopt.name) {\r\n                subopt.loader = [<IDynamicTaskOption>{ pipes: [], watch: true }];\r\n            }\r\n            // subopt.name = subopt.name || ctx.taskName(subopt.name); // ('sub' + idex++);\r\n            return subopt;\r\n        });\r\n\r\n        return this.createContexts(ctx, subtasks);\r\n\r\n    }\r\n}\r\n"]}