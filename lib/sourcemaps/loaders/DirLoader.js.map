{"version":3,"sources":["loaders/DirLoader.js","loaders/DirLoader.ts"],"names":["development_core_1","require","ModuleLoader_1","DirLoader","option","env","factory","_classCallCheck","this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","call","context","def","loader","dir","findTasksInDir","taskSourceVal","_get","prototype","self","configModule","module","findTaskDefineInDir","bindingConfig","createContext","ModuleLoader","exports"],"mappings":"AAAA,unCCCAA,mBAAAC,QAAgI,oBAEhIC,eAAAD,QAA6B,kBAE7BE,sBAEI,QAAAA,GAAYC,EAAqBC,EAAiBC,GAAmE,MAAAC,iBAAAC,KAAAL,GAAAM,2BAAAD,MAAAL,EAAAO,WAAAC,OAAAC,eAAAT,IAAAU,KAAAL,KAC3GJ,EAAQC,0EAGRS,EAAuBC,GAC7B,GAAIC,GAA2BR,KAAKJ,OAAOY,MAC3C,OAAIA,GAAOC,IACAH,EAAQI,eAAelB,mBAAAmB,cAAcH,EAAOC,IAAKH,IAExDM,KAAAjB,EAAAkB,UAAAX,WAAAC,OAAAC,eAAAT,EAAAkB,WAAA,YAAAb,MAAAK,KAAAL,KAAuBM,EAASC,8CAKpC,GAAIC,GAA2BR,KAAKJ,OAAOY,OACvCM,EAAOd,IACX,OAAKQ,GAAOO,cACJP,EAAOQ,SAAUR,EAAOC,IAG5BG,KAAAjB,EAAAkB,UAAAX,WAAAC,OAAAC,eAAAT,EAAAkB,WAAA,mBAAAb,MAAAK,KAAAL,MAFOR,mBAAAyB,oBAAoBzB,mBAAAmB,cAAcH,EAAOC,IAAKjB,mBAAA0B,eAAgBrB,IAAKiB,EAAKjB,IAAKD,UAAYuB,cAAeL,EAAKhB,mBApBjGJ,eAAA0B,aAAlBC,SAAA1B,UAASA","file":"../../loaders/DirLoader.js","sourcesContent":["\"use strict\";\nconst development_core_1 = require('development-core');\nconst ModuleLoader_1 = require('./ModuleLoader');\nclass DirLoader extends ModuleLoader_1.ModuleLoader {\n    constructor(option, env, factory) {\n        super(option, env);\n    }\n    loadTasks(context, def) {\n        let loader = this.option.loader;\n        if (loader.dir) {\n            return context.findTasksInDir(development_core_1.taskSourceVal(loader.dir, context));\n        }\n        else {\n            return super.loadTasks(context, def);\n        }\n    }\n    getContextDefine() {\n        let loader = this.option.loader;\n        let self = this;\n        if (!loader.configModule\n            && !loader.module && loader.dir) {\n            return development_core_1.findTaskDefineInDir(development_core_1.taskSourceVal(loader.dir, development_core_1.bindingConfig({ env: self.env, option: {}, createContext: self.factory })));\n        }\n        else {\n            return super.getContextDefine();\n        }\n    }\n}\nexports.DirLoader = DirLoader;\n","import * as _ from 'lodash';\r\nimport { ITask, IContextDefine, ITaskContext, bindingConfig, findTaskDefineInDir, ITaskConfig, taskSourceVal, IEnvOption } from 'development-core';\r\nimport { ITaskOption, IDirLoaderOption } from '../TaskOption';\r\nimport { ModuleLoader } from './ModuleLoader';\r\n\r\nexport class DirLoader extends ModuleLoader {\r\n\r\n    constructor(option: ITaskOption, env: IEnvOption, factory?: (cfg: ITaskConfig, parent?: ITaskContext) => ITaskContext) {\r\n        super(option, env);\r\n    }\r\n\r\n    loadTasks(context: ITaskContext, def: IContextDefine): Promise<ITask[]> {\r\n        let loader: IDirLoaderOption = this.option.loader;\r\n        if (loader.dir) {\r\n            return context.findTasksInDir(taskSourceVal(loader.dir, context));\r\n        } else {\r\n            return super.loadTasks(context, def);\r\n        }\r\n    }\r\n\r\n    protected getContextDefine(): IContextDefine | Promise<IContextDefine> {\r\n        let loader: IDirLoaderOption = this.option.loader;\r\n        let self = this;\r\n        if (!loader.configModule\r\n            && !loader.module && loader.dir) {\r\n            return findTaskDefineInDir(taskSourceVal(loader.dir, bindingConfig({ env: self.env, option: {}, createContext: self.factory })));\r\n        } else {\r\n            return super.getContextDefine();\r\n        }\r\n    }\r\n}\r\n"]}