"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,r,i){return r&&e(n.prototype,r),i&&e(n,i),n}}(),_=require("lodash"),requireDir=require("require-dir"),chalk=require("chalk"),BaseLoader=function(){function e(n){_classCallCheck(this,e),this.option=n}return _createClass(e,[{key:"load",value:function(e){var n=this;return this.getTaskDefine().then(function(r){if(r.moduleTaskLoader)return r.moduleTaskLoader(e);var i=n.getTaskModule();return n.loadTaskFromModule(i)}).catch(function(e){console.error(e)})}},{key:"loadConfg",value:function(e,n){var r=this;return this.getTaskDefine().then(function(i){return i.moduleTaskConfig(e,r.option,n)}).then(function(e){return r.bindingConfig(e)}).catch(function(e){console.error(e)})}},{key:"bindingConfig",value:function(e){var n=this;return e.findTasksInDir=e.findTasksInDir||function(e){return n.loadTaskFromDir(e)},e.findTasksInModule=e.findTasksInModule||function(e){return n.loadTaskFromModule(e)},e}},{key:"getTaskDefine",value:function(){var e=null,n=this.option.loader;if(n.taskDefine)e=n.taskDefine;else{var r=this.getConfigModule();e=this.findTaskDefine(r)}return e?Promise.resolve(e):Promise.reject("can not found task define.")}},{key:"getConfigModule",value:function(){var e=this.option.loader,n=e.configModule||e.module;return _.isString(n)?require(n):n}},{key:"getTaskModule",value:function(){var e=this.option.loader,n=e.taskModule||e.module;return _.isString(n)?require(n):n}},{key:"findTaskDefine",value:function(e){var n=this,r=null;return this.isTaskDefine(e)&&(r=e),!r&&e&&_.each(_.keys(e),function(i){return!r&&(n.isTaskDefine(e[i])&&(r=e[i]),!0)}),r}},{key:"isTaskDefine",value:function(e){if(!e)return!1;var n=this.option.loader;return n.isTaskDefine?n.isTaskDefine(e):_.isFunction(e.moduleTaskConfig)}},{key:"isTaskFunc",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return!1;var r=this.option.loader;return r.isTaskFunc?r.isTaskFunc(e):!!_.isFunction(e)||n}},{key:"findTasks",value:function(e){var n=this,r=[];return e?(this.isTaskFunc(e)?r.push(e):this.isTaskDefine(e)||(_.isArray(e)?_.each(e,function(e){r.concat(n.findTasks(e))}):_.each(_.keys(e),function(i){console.log(chalk.grey("register task from:"),chalk.cyan(i)),r=r.concat(n.findTasks(e[i]))})),r):r}},{key:"loadTaskFromModule",value:function(e){var n=this.findTasks(e);return!n||n.length<1?(console.log(chalk.red("error module:"),e),Promise.reject("has not found task in module.")):Promise.resolve(n)}},{key:"loadTaskFromDir",value:function(e){var n=this;return Promise.all(_.map(_.isArray(e)?e:[e],function(e){console.log(chalk.grey("begin load task from dir"),chalk.cyan(e));var r=requireDir(e,{recurse:!0});return n.loadTaskFromModule(r)})).then(function(e){return _.flatten(e)})}}]),e}();exports.BaseLoader=BaseLoader;
//# sourceMappingURL=../sourcemaps/loaders/BaseLoader.js.map
